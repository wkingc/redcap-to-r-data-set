<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>redcap_to_r_data_set.utf8</title>

<script src="redcap_to_r_data_set_files/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="redcap_to_r_data_set_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="redcap_to_r_data_set_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="redcap_to_r_data_set_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="redcap_to_r_data_set_files/navigation-1.1/tabsets.js"></script>
<script src="redcap_to_r_data_set_files/navigation-1.1/codefolding.js"></script>
<link href="redcap_to_r_data_set_files/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/highlightjs-9.12.0/highlight.js"></script>
<link href="redcap_to_r_data_set_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/anchor-sections-1.0/anchor-sections.js"></script>
<script src="redcap_to_r_data_set_files/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="redcap_to_r_data_set_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/datatables-binding-0.16/datatables.js"></script>
<link href="redcap_to_r_data_set_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="redcap_to_r_data_set_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="redcap_to_r_data_set_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="redcap_to_r_data_set_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/selectize-0.12.0/selectize.min.js"></script>
<link href="redcap_to_r_data_set_files/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="redcap_to_r_data_set_files/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Many investigators, project managers, and data managers have turned to REDCap to manage their data <span class="citation">(Harris et al. <a href="#ref-harris2009metadata" role="doc-biblioref">2009</a>, <a href="#ref-harris2019redcap" role="doc-biblioref">2019</a>)</span>. Eventually, it falls to the statistician to take the REDCap data and load it into their statistical analysis program of choice. In this presentation, I show how to use the CSV and R script file downloaded from REDCap to create a clean R data set.</p>
<p>This presentation will use the R programming language and assume the user is using Rstudio to compile their R markdown files into HTML <span class="citation">(R Core Team <a href="#ref-Rlang2019" role="doc-biblioref">2019</a>; RStudio Team <a href="#ref-Rstudio" role="doc-biblioref">2016</a>)</span>. If you want to follow along with the R markdown, it is downloadable <a href="https://waderstats.com/rstudio-files/redcap_to_r_data_set/redcap_to_r_data_set.Rmd" target="_blank">here</a>. The associated bibliography file is <a href="https://waderstats.com/rstudio-files/redcap_to_r_data_set/redcap_to_r_data_set.bib" target="_blank">here</a>.</p>
</div>
<div id="libraries" class="section level1">
<h1>Libraries</h1>
<p>The libraries <i>knitr</i>, <i>bookdown</i>, <i>kableExtra</i>, and <i>DT</i>, generate the HTML output <span class="citation">(Xie <a href="#ref-knitr" role="doc-biblioref">2019</a>, <a href="#ref-bookdown" role="doc-biblioref">2018</a>; Zhu <a href="#ref-kableExtra" role="doc-biblioref">2019</a>; Xie, Cheng, and Tan <a href="#ref-DT" role="doc-biblioref">2018</a>)</span>. The <i>Hmisc</i> library is loaded to generate and store variable labels <span class="citation">(Harrell Jr, Charles Dupont, and others. <a href="#ref-Hmisc" role="doc-biblioref">2019</a>)</span>.</p>
<pre class="r"><code>package_loader &lt;- function(x, ...) {
  if (x %in% rownames(installed.packages()) == FALSE) install.packages(x)
  library(x, ...)
}

packages &lt;- c(&quot;knitr&quot;, &quot;bookdown&quot;, &quot;kableExtra&quot;, &quot;DT&quot;, &quot;Hmisc&quot;)

invisible(sapply(X = packages, FUN = package_loader, character.only = TRUE))</code></pre>
</div>
<div id="redcap-data-structure" class="section level1">
<h1>REDCap Data Structure</h1>
<p>For this presentation, I created two files that mimic the general structure of data exported from REDCap for use in the R programming language. This structure is accurate as of REDCap version 9.1.0. While not the focus of this presentation, for the sake of reproducibility, the file used the generate the example data is downloadable <a href="https://waderstats.com/rstudio-files/redcap_to_r_data_set/redcap_to_r_data_set.r" target="_blank">here</a>.</p>
<p>The first file is a flat-file of comma-separated values (CSV). Below is a display of the example data downloaded <a href="https://waderstats.com/rstudio-files/redcap_to_r_data_set/fromREDCap_DATA_2019-12-05_1111.csv" target="_blank">here</a>. Of note, all of the factor variables, such as sex, are numerically coded. There are also indicators for ambiguous data (666) and missing data (999).</p>
<pre class="r"><code>d_csv &lt;- read.csv(file = &quot;fromREDCap_DATA_2019-12-05_1111.csv&quot;, stringsAsFactors = FALSE)

d_csv_DT &lt;- datatable(d_csv,
          rownames = FALSE,
          class = &#39;cell-border stripe&#39;,
          caption = htmltools::tags$caption(
            style = &#39;caption-side: bottom; text-align: center;&#39;,
            &#39;&#39;, htmltools::em(&#39;The CSV file generated with REDCap for use with the R programming language.  Of note, all of the factor variables are numerically coded.&#39;)
          ),
          filter = &#39;top&#39;,
          options = list(pageLength = 5,
                         autoWidth = TRUE,
                         scrollX = TRUE
          )
)

d_csv_DT</code></pre>
<div id="htmlwidget-cb24fc777bf6cfbf1b35" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-cb24fc777bf6cfbf1b35">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"999\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"25\" data-max=\"999\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"999\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption style=\"caption-side: bottom; text-align: center;\">\n  \n  <em>The CSV file generated with REDCap for use with the R programming language.  Of note, all of the factor variables are numerically coded.<\/em>\n<\/caption>","data":[[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25],["baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup","baseline","followup"],["2016-07-30","2017-05-23","2016-09-16","2017-02-19","2015-12-07","2017-09-30","2015-06-25","2018-01-25","2015-12-23","2016-07-19","2016-08-10","2017-08-02","2016-04-12","2017-08-05","2015-10-07","2017-06-28","2016-04-05","2016-12-28","2016-01-26","2018-04-13","2016-02-10","2016-05-12","2016-09-30","2017-06-17","2016-06-19","2017-04-24","2015-11-11","2017-09-02","2015-09-09","2018-02-03","2015-09-10","2018-04-11","2016-02-22","2016-02-23","2015-12-25","2016-10-25","2016-09-18","2016-09-19","2016-08-25","2018-03-21","2016-05-24","2016-08-01","2015-10-26","2016-06-04","2016-05-31","2016-07-25","2016-05-04","2016-10-06","2015-07-07","2017-07-24"],[1,null,1,null,1,null,0,null,1,null,0,null,0,null,0,null,1,null,0,null,0,null,0,null,1,null,1,null,1,null,1,null,0,null,1,null,1,null,1,null,0,null,1,null,0,null,1,null,1,null],[1,null,1,null,999,null,2,null,2,null,1,null,2,null,1,null,2,null,2,null,1,null,999,null,2,null,999,null,1,null,2,null,2,null,1,null,2,null,1,null,1,null,1,null,2,null,2,null,1,null],[37,null,35,null,32,null,61,null,666,null,666,null,52,null,46,null,44,null,47,null,38,null,37,null,30,null,32,null,25,null,666,null,39,null,33,null,37,null,32,null,999,null,36,null,999,null,999,null,32,null],[1,4,2,3,4,2,2,666,3,1,1,5,3,3,1,3,2,6,2,7,999,3,2,666,4,666,4,999,1,1,999,999,6,4,2,4,4,5,999,7,2,999,666,3,1,4,2,1,1,3],["My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," "," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!"," "," "," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!","The thing is, I can't complete my model because my grandma drank it, probably silently.","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," "," "," "," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!","The thing is, I can't complete my model because my grandma drank it, probably silently.","The thing is, I can't complete my model because my grandma drank it, probably silently."," ","The thing is, I can't complete my model because my grandma drank it, probably silently."," "," "," "," "]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>record_id<\/th>\n      <th>redcap_event_name<\/th>\n      <th>visit_date<\/th>\n      <th>randomization<\/th>\n      <th>sex<\/th>\n      <th>age<\/th>\n      <th>social_connectedness<\/th>\n      <th>comments<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,3,4,5,6]}],"order":[],"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>The second file is an R script that codes the data for use in R. The contents of the example REDCap script file used in this presentation are shown below and downloadable <a href="https://waderstats.com/rstudio-files/redcap_to_r_data_set/fromREDCap_R_2019-12-05_1111.r" target="_blank">here</a>. We see that the <i>Hmisc</i> library is used to set the labels, and none of the numerically coded variables are stored as factors, but rather as new variables with <i>.factor</i> appended.</p>
<pre class="r"><code>d_script &lt;- readLines(&quot;fromREDCap_R_2019-12-05_1111.r&quot;)

cat(paste(d_script, &quot;\n&quot;, sep = &quot;&quot;))</code></pre>
<pre><code>## #Clear existing data and graphics
##  rm(list=ls())
##  graphics.off()
##  #Load Hmisc library
##  library(Hmisc)
##  #Read Data
##  data=read.csv(&#39;fromREDCap_DATA_2019-12-05_1111.csv&#39;)
##  #Setting Labels
##  
##  label(data$record_id)=&quot;Record ID&quot;
##  label(data$redcap_event_name)=&quot;Event Name&quot;
##  label(data$visit_date) =&quot;Visit Date&quot;
##  label(data$randomization)=&quot;Randomization&quot;
##  label(data$sex)=&quot;Sex&quot;
##  label(data$age)=&quot;Age&quot;
##  label(data$social_connectedness)=&quot;Social Connectedness&quot;
##  label(data$comments)=&quot;Comments&quot;
##                   
##  #Setting Factors(will create new variable for factors)
##  data$redcap_event_name.factor = factor(data$redcap_event_name,levels=c(&quot;baseline&quot;, &quot;followup&quot;))
##  data$randomization.factor = factor(data$randomization,levels=c(&quot;0&quot;, &quot;1&quot;))
##  data$sex.factor = factor(data$sex,levels=c(&quot;0&quot;, &quot;1&quot;, &quot;666&quot;, &quot;999&quot;))
##  data$social_connectedness.factor = factor(data$social_connectedness,levels=c(&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;666&quot;, &quot;999&quot;))
##  
##  levels(data$redcap_event_name.factor)=c(&quot;Baseline&quot;,&quot;Follow-up&quot;)
##  levels(data$randomization.factor)=c(&quot;Control&quot;,&quot;Treatment&quot;)
##  levels(data$sex.factor)=c(&quot;Male&quot;,&quot;Female&quot;,&quot;Ambiguous&quot;,&quot;Missing&quot;)
##  levels(data$social_connectedness)=c(&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;Ambiguous&quot;,&quot;Missing&quot;)</code></pre>
</div>
<div id="redcap-script-file-clean-up-and-parsing" class="section level1">
<h1>REDCap Script File Clean-up and Parsing</h1>
<p>To set up the data, we want to parse and evaluate the script file with the primary goal of removing the appended <i>.factor</i>. The function <b>redcap_to_r_data_set</b> does just that. It takes two arguments; The first is <i>redcap_data_file</i>, which is the path to the REDCap data set. The second is <i>redcap_script_file</i>, which is the path to the REDCap script file.</p>
<pre class="r"><code>redcap_to_r_data_set &lt;- function(redcap_data_file, redcap_script_file) {
  # Read in the data and script file.
  redcap_data &lt;- read.csv(file = redcap_data_file, stringsAsFactors = FALSE)
  redcap_script &lt;- readLines(redcap_script_file)

  # We want to remove the appended .factor, but since releveling the numerically coded data erases the labels, we need to reorder the file so that the labels are last.
    # Every line in the script file that uses the factor() function
    redcap_factor &lt;- redcap_script[grep(&quot;factor\\(&quot;, redcap_script)]
    
    # Every line in the script file that uses the levels() function
    redcap_levels &lt;- redcap_script[grep(&quot;levels\\(&quot;, redcap_script)]
    
    # Every line in the script file that begins with the label function
    redcap_label &lt;- redcap_script[grep(&quot;^label\\(&quot;, redcap_script)]
    
    # Reorder the chunks in the script file.
    redcap_reorder &lt;- c(redcap_factor, &quot;&quot;, redcap_levels, &quot;&quot;, redcap_label)
    
    # Remove the appended .factor.
    redcap_no_append &lt;- gsub(&quot;\\.factor&quot;, &quot;&quot;, redcap_reorder)
    
  # REDCap defaults to calling the data &#39;data&#39;.  Before evaluating, we need to change this to what the data is named here.
  redcap_rename &lt;- gsub(&quot;data\\$&quot;, &quot;redcap_data\\$&quot;, redcap_no_append)

  # Now we can safely evaluate the script file.
  eval(parse(text = redcap_rename))
  
  return(redcap_data)
}

d &lt;- redcap_to_r_data_set(redcap_data_file = &quot;fromREDCap_DATA_2019-12-05_1111.csv&quot;, redcap_script_file = &quot;fromREDCap_R_2019-12-05_1111.r&quot;)</code></pre>
<p>Below is the completed R data set after cleaning and parsing the REDCap script file.</p>
<pre class="r"><code>d_DT &lt;- datatable(d,
          rownames = FALSE,
          class = &#39;cell-border stripe&#39;,
          caption = htmltools::tags$caption(
            style = &#39;caption-side: bottom; text-align: center;&#39;,
            &#39;&#39;, htmltools::em(&#39;The complete R data set after cleaning and parsing the REDCap script file.&#39;)
          ),
          filter = &#39;top&#39;,
          options = list(pageLength = 5,
                         autoWidth = TRUE,
                         scrollX = TRUE
          )
)

d_DT</code></pre>
<div id="htmlwidget-d8fc88ec47732654fcca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d8fc88ec47732654fcca">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Baseline&quot;,&quot;Follow-up&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Control&quot;,&quot;Treatment&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Male&quot;,&quot;Female&quot;,&quot;Ambiguous&quot;,&quot;Missing&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"25\" data-max=\"999\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;Ambiguous&quot;,&quot;Missing&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption style=\"caption-side: bottom; text-align: center;\">\n  \n  <em>The complete R data set after cleaning and parsing the REDCap script file.<\/em>\n<\/caption>","data":[[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25],["Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up","Baseline","Follow-up"],["2016-07-30","2017-05-23","2016-09-16","2017-02-19","2015-12-07","2017-09-30","2015-06-25","2018-01-25","2015-12-23","2016-07-19","2016-08-10","2017-08-02","2016-04-12","2017-08-05","2015-10-07","2017-06-28","2016-04-05","2016-12-28","2016-01-26","2018-04-13","2016-02-10","2016-05-12","2016-09-30","2017-06-17","2016-06-19","2017-04-24","2015-11-11","2017-09-02","2015-09-09","2018-02-03","2015-09-10","2018-04-11","2016-02-22","2016-02-23","2015-12-25","2016-10-25","2016-09-18","2016-09-19","2016-08-25","2018-03-21","2016-05-24","2016-08-01","2015-10-26","2016-06-04","2016-05-31","2016-07-25","2016-05-04","2016-10-06","2015-07-07","2017-07-24"],["Treatment",null,"Treatment",null,"Treatment",null,"Control",null,"Treatment",null,"Control",null,"Control",null,"Control",null,"Treatment",null,"Control",null,"Control",null,"Control",null,"Treatment",null,"Treatment",null,"Treatment",null,"Treatment",null,"Control",null,"Treatment",null,"Treatment",null,"Treatment",null,"Control",null,"Treatment",null,"Control",null,"Treatment",null,"Treatment",null],["Female",null,"Female",null,"Missing",null,null,null,null,null,"Female",null,null,null,"Female",null,null,null,null,null,"Female",null,"Missing",null,null,null,"Missing",null,"Female",null,null,null,null,null,"Female",null,null,null,"Female",null,"Female",null,"Female",null,null,null,null,null,"Female",null],[37,null,35,null,32,null,61,null,666,null,666,null,52,null,46,null,44,null,47,null,38,null,37,null,30,null,32,null,25,null,666,null,39,null,33,null,37,null,32,null,999,null,36,null,999,null,999,null,32,null],["1","4","2","3","4","2","2","Ambiguous","3","1","1","5","3","3","1","3","2","6","2","7","Missing","3","2","Ambiguous","4","Ambiguous","4","Missing","1","1","Missing","Missing","6","4","2","4","4","5","Missing","7","2","Missing","Ambiguous","3","1","4","2","1","1","3"],["My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," "," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!"," "," "," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!","The thing is, I can't complete my model because my grandma drank it, probably silently.","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," "," "," "," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","They're inside the form factor, use the mobile RX card to attach their capacitor!"," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," ","The thing is, I can't complete my model because my grandma drank it, probably silently.","They're inside the form factor, use the mobile RX card to attach their capacitor!","My PNG microchip is down, our only choice is to shut down and connect the digital panel!"," ","My PNG microchip is down, our only choice is to shut down and connect the digital panel!","They're inside the form factor, use the mobile RX card to attach their capacitor!","The thing is, I can't complete my model because my grandma drank it, probably silently.","The thing is, I can't complete my model because my grandma drank it, probably silently."," ","The thing is, I can't complete my model because my grandma drank it, probably silently."," "," "," "," "]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>record_id<\/th>\n      <th>redcap_event_name<\/th>\n      <th>visit_date<\/th>\n      <th>randomization<\/th>\n      <th>sex<\/th>\n      <th>age<\/th>\n      <th>social_connectedness<\/th>\n      <th>comments<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,5]}],"order":[],"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Printing the data summary shows that variable coding worked as expected. The label accessor function shows that the labels were accurately created.</p>
<pre class="r"><code>summary(d)</code></pre>
<pre><code>##    record_id  redcap_event_name  visit_date          randomization
##  Min.   : 1   Baseline :25      Length:50          Control  :10   
##  1st Qu.: 7   Follow-up:25      Class1:labelled    Treatment:15   
##  Median :13                     Class2:character   NA&#39;s     :25   
##  Mean   :13                     Mode  :character                  
##  3rd Qu.:19                                                       
##  Max.   :25                                                       
##                                                                   
##         sex          age        social_connectedness   comments        
##  Male     : 0   Min.   : 25.0   1        :9          Length:50         
##  Female   :11   1st Qu.: 33.0   2        :9          Class1:labelled   
##  Ambiguous: 0   Median : 38.0   3        :8          Class2:character  
##  Missing  : 3   Mean   :228.8   4        :8          Mode  :character  
##  NA&#39;s     :36   3rd Qu.: 61.0   Missing  :6                            
##                 Max.   :999.0   Ambiguous:4                            
##                 NA&#39;s   :25      (Other)  :6</code></pre>
<pre class="r"><code>label(d)</code></pre>
<pre><code>##              record_id      redcap_event_name             visit_date 
##            &quot;Record ID&quot;           &quot;Event Name&quot;           &quot;Visit Date&quot; 
##          randomization                    sex                    age 
##        &quot;Randomization&quot;                  &quot;Sex&quot;                  &quot;Age&quot; 
##   social_connectedness               comments 
## &quot;Social Connectedness&quot;             &quot;Comments&quot;</code></pre>
</div>
<div id="session-info" class="section level1">
<h1>Session Info</h1>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   
## 
## attached base packages:
## [1] stats     graphics  grDevices datasets  utils     methods   base     
## 
## other attached packages:
## [1] Hmisc_4.4-1      ggplot2_3.3.2    Formula_1.2-4    survival_3.2-7  
## [5] lattice_0.20-41  DT_0.16          kableExtra_1.3.1 bookdown_0.21   
## [9] knitr_1.30      
## 
## loaded via a namespace (and not attached):
##  [1] xfun_0.19           splines_4.0.3       colorspace_2.0-0   
##  [4] vctrs_0.3.5         htmltools_0.5.0     viridisLite_0.3.0  
##  [7] yaml_2.2.1          base64enc_0.1-3     rlang_0.4.8        
## [10] pillar_1.4.6        foreign_0.8-79      glue_1.4.2         
## [13] withr_2.3.0         RColorBrewer_1.1-2  jpeg_0.1-8.1       
## [16] lifecycle_0.2.0     stringr_1.4.0       munsell_0.5.0      
## [19] gtable_0.3.0        rvest_0.3.6         htmlwidgets_1.5.2  
## [22] evaluate_0.14       latticeExtra_0.6-29 crosstalk_1.1.0.1  
## [25] htmlTable_2.1.0     backports_1.2.0     checkmate_2.0.0    
## [28] renv_0.12.2         scales_1.1.1        jsonlite_1.7.1     
## [31] webshot_0.5.2       gridExtra_2.3       png_0.1-7          
## [34] digest_0.6.27       stringi_1.5.3       grid_4.0.3         
## [37] tools_4.0.3         magrittr_2.0.1      tibble_3.0.4       
## [40] cluster_2.1.0       crayon_1.3.4        pkgconfig_2.0.3    
## [43] ellipsis_0.3.1      Matrix_1.2-18       data.table_1.13.2  
## [46] xml2_1.3.2          rmarkdown_2.5       httr_1.4.2         
## [49] rstudioapi_0.13     R6_2.5.0            rpart_4.1-15       
## [52] nnet_7.3-14         compiler_4.0.3</code></pre>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<!-- This is needed to resize iframe content. Please ignore if duplicationg this R markdown file -->
<script type="text/javascript" src="https://www.waderstats.com/wp-includes/js/iframe-resizer/js/iframeResizer.contentWindow.min.js" defer></script>
<div id="refs" class="references">
<div id="ref-Hmisc">
<p>Harrell Jr, Frank E, with contributions from Charles Dupont, and many others. 2019. <em>Hmisc: Harrell Miscellaneous</em>. <a href="https://CRAN.R-project.org/package=Hmisc">https://CRAN.R-project.org/package=Hmisc</a>.</p>
</div>
<div id="ref-harris2019redcap">
<p>Harris, Paul A, Robert Taylor, Brenda L Minor, Veida Elliott, Michelle Fernandez, Lindsay O’Neal, Laura McLeod, et al. 2019. “The Redcap Consortium: Building an International Community of Software Platform Partners.” <em>Journal of Biomedical Informatics</em> 95: 103208.</p>
</div>
<div id="ref-harris2009metadata">
<p>Harris, Paul A, Robert Taylor, Robert Thielke, Jonathon Payne, Nathaniel Gonzalez, Jose G Conde, and others. 2009. “A Metadata-Driven Methodology and Workflow Process for Providing Translational Research Informatics Support.” <em>J Biomed Inform</em> 42 (2): 377–81.</p>
</div>
<div id="ref-Rlang2019">
<p>R Core Team. 2019. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-Rstudio">
<p>RStudio Team. 2016. <em>RStudio: Integrated Development Environment for R</em>. Boston, MA: RStudio, Inc. <a href="http://www.rstudio.com/">http://www.rstudio.com/</a>.</p>
</div>
<div id="ref-bookdown">
<p>Xie, Yihui. 2018. <em>Bookdown: Authoring Books and Technical Documents with R Markdown</em>. <a href="https://github.com/rstudio/bookdown">https://github.com/rstudio/bookdown</a>.</p>
</div>
<div id="ref-knitr">
<p>———. 2019. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. <a href="https://yihui.name/knitr/">https://yihui.name/knitr/</a>.</p>
</div>
<div id="ref-DT">
<p>Xie, Yihui, Joe Cheng, and Xianying Tan. 2018. <em>DT: A Wrapper of the Javascript Library ’Datatables’</em>. <a href="https://CRAN.R-project.org/package=DT">https://CRAN.R-project.org/package=DT</a>.</p>
</div>
<div id="ref-kableExtra">
<p>Zhu, Hao. 2019. <em>KableExtra: Construct Complex Table with ’Kable’ and Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</a>.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "redcap_to_r_data_set_files/mathjax-local/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
